<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangladesh Public Opinion Poll</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            onSnapshot,
            query,
            where,
            doc,
            updateDoc,
            deleteDoc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        // REPLACE WITH YOUR FIREBASE CONFIG
     const firebaseConfig = {
    apiKey: "AIzaSyDdOPOmE1dhzyVRDLowr30GAi0LnjmDHt0",
    authDomain: "bangladesh-opinion-poll.firebaseapp.com",
    projectId: "bangladesh-opinion-poll",
    storageBucket: "bangladesh-opinion-poll.firebasestorage.app",
    messagingSenderId: "1006245972517",
    appId: "1:1006245972517:web:8bdda3e095c4375c438dcc",
    measurementId: "G-1RNP4Q7XX9"
};
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseModules = {
            db,
            collection,
            addDoc,
            getDocs,
            onSnapshot,
            query,
            where,
            doc,
            updateDoc,
            deleteDoc,
            setDoc
        };
    </script>
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #15803d;
            border-radius: 4px;
        }
        /* Smooth transitions */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Vote button animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .vote-pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-green-800 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 bg-red-500 rounded-full"></div>
                    <h1 class="text-xl font-bold">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§</h1>
                </div>
                
                <!-- Mobile menu button -->
                <button id="mobileMenuBtn" class="md:hidden text-2xl">
                    ‚ò∞
                </button>
                
                <!-- Desktop menu -->
                <div class="hidden md:flex space-x-6">
                    <a href="#home" class="nav-link hover:text-green-200 font-medium">Home</a>
                    <a href="#vote" class="nav-link hover:text-green-200 font-medium">Vote Now</a>
                    <a href="#results" class="nav-link hover:text-green-200 font-medium">Live Results</a>
                    <a href="#stats" class="nav-link hover:text-green-200 font-medium">Statistics</a>
                    <a href="#admin" class="nav-link hover:text-green-200 font-medium">Admin Panel</a>
                    <a href="#disclaimer" class="nav-link hover:text-green-200 font-medium">Disclaimer</a>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div id="mobileMenu" class="md:hidden hidden pb-4">
                <div class="flex flex-col space-y-3">
                    <a href="#home" class="nav-link hover:text-green-200">Home</a>
                    <a href="#vote" class="nav-link hover:text-green-200">Vote Now</a>
                    <a href="#results" class="nav-link hover:text-green-200">Live Results</a>
                    <a href="#stats" class="nav-link hover:text-green-200">Statistics</a>
                    <a href="#admin" class="nav-link hover:text-green-200">Admin Panel</a>
                    <a href="#disclaimer" class="nav-link hover:text-green-200">Disclaimer</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Home Section -->
        <section id="home" class="mb-16 fade-in">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-green-900 mb-4">Bangladesh Public Opinion Poll</h2>
                <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                    Participate in this non-official public opinion poll to express your preference. 
                    This is a mock election for educational and demonstration purposes only.
                </p>
            </div>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-200">
                    <div class="text-green-600 text-4xl mb-4">üó≥Ô∏è</div>
                    <h3 class="text-xl font-bold text-green-800 mb-2">Cast Your Vote</h3>
                    <p class="text-gray-600">Select your division, district, and constituency to vote for your preferred candidate.</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-200">
                    <div class="text-green-600 text-4xl mb-4">üìä</div>
                    <h3 class="text-xl font-bold text-green-800 mb-2">Live Results</h3>
                    <p class="text-gray-600">Watch real-time vote counts and see how opinions are changing across Bangladesh.</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-200">
                    <div class="text-green-600 text-4xl mb-4">üîí</div>
                    <h3 class="text-xl font-bold text-green-800 mb-2">Secure & Private</h3>
                    <p class="text-gray-600">One vote per device ensures fair participation. Your privacy is protected.</p>
                </div>
            </div>
            
            <div class="text-center mt-12">
                <a href="#vote" class="bg-green-700 hover:bg-green-800 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transition duration-300 inline-block">
                    Start Voting Now ‚Üí
                </a>
            </div>
        </section>

        <!-- Vote Now Section -->
        <section id="vote" class="mb-16 fade-in">
            <h2 class="text-3xl font-bold text-green-900 mb-2 border-b pb-2">Vote Now</h2>
            <p class="text-gray-600 mb-6">Select your location and cast your vote for your preferred candidate.</p>
            
            <!-- Voting Status Alert -->
            <div id="voteStatus" class="hidden mb-6 p-4 rounded-lg"></div>
            
            <!-- Voting Steps -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <!-- Step Indicators -->
                <div class="flex justify-between mb-8 relative">
                    <div class="step-item flex flex-col items-center z-10">
                        <div class="step-circle bg-green-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-bold">1</div>
                        <span class="mt-2 text-sm font-medium">Select Division</span>
                    </div>
                    <div class="step-item flex flex-col items-center z-10">
                        <div class="step-circle bg-gray-300 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center font-bold">2</div>
                        <span class="mt-2 text-sm font-medium">Select District</span>
                    </div>
                    <div class="step-item flex flex-col items-center z-10">
                        <div class="step-circle bg-gray-300 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center font-bold">3</div>
                        <span class="mt-2 text-sm font-medium">Select Constituency</span>
                    </div>
                    <div class="step-item flex flex-col items-center z-10">
                        <div class="step-circle bg-gray-300 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center font-bold">4</div>
                        <span class="mt-2 text-sm font-medium">Vote</span>
                    </div>
                    <div class="absolute top-5 left-10 right-10 h-1 bg-gray-300 z-0"></div>
                </div>
                
                <!-- Step 1: Select Division -->
                <div id="step1" class="step-content">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Select Your Division</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="divisionList">
                        <!-- Divisions will be loaded here -->
                    </div>
                    <button id="nextToStep2" class="mt-6 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Next: Select District ‚Üí
                    </button>
                </div>
                
                <!-- Step 2: Select District -->
                <div id="step2" class="step-content hidden">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Select Your District</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="districtList">
                        <!-- Districts will be loaded here -->
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="backToStep1" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-6 rounded-lg">
                            ‚Üê Back to Divisions
                        </button>
                        <button id="nextToStep3" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Next: Select Constituency ‚Üí
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Select Constituency -->
                <div id="step3" class="step-content hidden">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Select Your Constituency</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="constituencyList">
                        <!-- Constituencies will be loaded here -->
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="backToStep2" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-6 rounded-lg">
                            ‚Üê Back to Districts
                        </button>
                        <button id="nextToStep4" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Next: Vote for Candidate ‚Üí
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Vote for Candidate -->
                <div id="step4" class="step-content hidden">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Select Your Candidate</h3>
                    <p class="text-gray-600 mb-6" id="selectedLocation">Voting in: <span class="font-semibold"></span></p>
                    <div class="space-y-4" id="candidateList">
                        <!-- Candidates will be loaded here -->
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="backToStep3" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-6 rounded-lg">
                            ‚Üê Back to Constituencies
                        </button>
                        <button id="submitVote" class="bg-green-700 hover:bg-green-800 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg vote-pulse disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            üó≥Ô∏è Cast Your Vote
                        </button>
                    </div>
                </div>
                
                <!-- Voting Complete Message -->
                <div id="voteComplete" class="hidden text-center py-8">
                    <div class="text-green-600 text-6xl mb-4">‚úÖ</div>
                    <h3 class="text-2xl font-bold text-green-800 mb-2">Thank You for Voting!</h3>
                    <p class="text-gray-600 mb-6">Your vote has been recorded successfully.</p>
                    <p class="text-sm text-gray-500">You can view live results in the <a href="#results" class="text-green-600 font-medium">Live Results</a> section.</p>
                    <button id="voteAgain" class="mt-6 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg">
                        View Live Results ‚Üí
                    </button>
                </div>
            </div>
        </section>

        <!-- Live Results Section -->
        <section id="results" class="mb-16 fade-in">
            <h2 class="text-3xl font-bold text-green-900 mb-2 border-b pb-2">Live Results</h2>
            <p class="text-gray-600 mb-6">Real-time vote counts across all constituencies. Results update automatically.</p>
            
            <!-- Results Filter -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-green-800">National Vote Count</h3>
                    <div class="flex space-x-4 mt-4 md:mt-0">
                        <select id="resultsDivisionFilter" class="border border-gray-300 rounded-lg px-4 py-2">
                            <option value="all">All Divisions</option>
                        </select>
                        <button id="refreshResults" class="bg-green-100 hover:bg-green-200 text-green-800 font-medium py-2 px-4 rounded-lg">
                            Refresh Results
                        </button>
                    </div>
                </div>
                
                <!-- Total Votes Counter -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center">
                        <div class="text-green-600 text-3xl mr-4">üìà</div>
                        <div>
                            <h4 class="font-bold text-green-800">Total Votes Cast Nationwide</h4>
                            <div class="flex items-baseline">
                                <span id="totalVotesCount" class="text-4xl font-bold text-green-700 mr-2">0</span>
                                <span class="text-gray-600">votes</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Charts -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold text-green-800 mb-4">Top Candidates by Votes</h4>
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <canvas id="votesBarChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-green-800 mb-4">Vote Distribution</h4>
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <canvas id="votesPieChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Live Results Table -->
                <div class="mt-8">
                    <h4 class="font-bold text-green-800 mb-4">Detailed Results by Constituency</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead>
                                <tr class="bg-green-50">
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Candidate</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Party</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Constituency</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Votes</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Percentage</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <!-- Results will be loaded here -->
                                <tr>
                                    <td colspan="5" class="py-8 text-center text-gray-500">
                                        Loading live results...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics Section -->
        <section id="stats" class="mb-16 fade-in">
            <h2 class="text-3xl font-bold text-green-900 mb-2 border-b pb-2">Statistics & Analytics</h2>
            <p class="text-gray-600 mb-6">Detailed analysis of voting patterns and participation rates.</p>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Voter Participation</h3>
                    <div class="h-64">
                        <canvas id="participationChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Division-wise Votes</h3>
                    <div class="h-64">
                        <canvas id="divisionChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold text-green-800 mb-4">Voting Trends</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-green-800">Highest Turnout</span>
                                <span class="text-sm font-medium text-green-800" id="highestTurnout">--</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="highestTurnoutBar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-green-800">Lowest Turnout</span>
                                <span class="text-sm font-medium text-green-800" id="lowestTurnout">--</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="lowestTurnoutBar" class="bg-green-400 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t border-gray-200">
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-600">Average Votes per Constituency</span>
                                <span class="font-bold text-green-800" id="avgVotes">0</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-600">Most Popular Party</span>
                                <span class="font-bold text-green-800" id="popularParty">--</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Candidates</span>
                                <span class="font-bold text-green-800" id="totalCandidates">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Panel Section -->
        <section id="admin" class="mb-16 fade-in">
            <h2 class="text-3xl font-bold text-green-900 mb-2 border-b pb-2">Admin Panel</h2>
            <p class="text-gray-600 mb-6">Administrative functions for managing the voting system. (Demo Only)</p>
            
            <!-- Admin Login -->
            <div id="adminLogin" class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-green-800 mb-4">Admin Login</h3>
                <p class="text-gray-600 mb-4">Enter the admin password to access management functions.</p>
                <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                    <input type="password" id="adminPassword" placeholder="Enter admin password" class="border border-gray-300 rounded-lg px-4 py-2 flex-grow">
                    <button id="loginAdmin" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg">
                        Login
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-4">Demo password: <code class="bg-gray-100 px-2 py-1 rounded">admin123</code></p>
            </div>
            
            <!-- Admin Dashboard (Hidden by Default) -->
            <div id="adminDashboard" class="hidden">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold text-green-800">Admin Dashboard</h3>
                            <p class="text-green-700">You are logged in as Administrator</p>
                        </div>
                        <button id="logoutAdmin" class="bg-red-100 hover:bg-red-200 text-red-800 font-medium py-2 px-4 rounded-lg">
                            Logout
                        </button>
                    </div>
                </div>
                
                <!-- Admin Actions -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <!-- Add Candidate -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h4 class="text-lg font-bold text-green-800 mb-4">Add New Candidate</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Candidate Name</label>
                                <input type="text" id="candidateName" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Party</label>
                                <input type="text" id="candidateParty" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Select Constituency</label>
                                <select id="adminConstituency" class="w-full border border-gray-300 rounded-lg px-4 py-2">
                                    <!-- Constituencies will be loaded here -->
                                </select>
                            </div>
                            <button id="addCandidateBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg">
                                Add Candidate
                            </button>
                        </div>
                    </div>
                    
                    <!-- System Management -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h4 class="text-lg font-bold text-green-800 mb-4">System Management</h4>
                        <div class="space-y-4">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <h5 class="font-bold text-red-800 mb-2">‚ö†Ô∏è Danger Zone</h5>
                                <p class="text-red-700 text-sm mb-4">These actions cannot be undone. Use with extreme caution.</p>
                                <div class="flex space-x-4">
                                    <button id="resetAllVotes" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg">
                                        Reset All Votes
                                    </button>
                                    <button id="clearCandidates" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg">
                                        Clear All Candidates
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <h5 class="font-bold text-yellow-800 mb-2">System Information</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Total Votes in Database</span>
                                        <span class="font-bold" id="adminTotalVotes">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Total Candidates</span>
                                        <span class="font-bold" id="adminTotalCandidates">0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">System Status</span>
                                        <span class="font-bold text-green-600">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Candidate List -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h4 class="text-lg font-bold text-green-800 mb-4">Manage Candidates</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead>
                                <tr class="bg-green-50">
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Name</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Party</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Constituency</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Votes</th>
                                    <th class="py-3 px-4 text-left font-bold text-green-800">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminCandidateTable">
                                <!-- Candidates will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Disclaimer Section -->
        <section id="disclaimer" class="fade-in">
            <div class="bg-white rounded-xl shadow-lg p-8 border border-red-300">
                <div class="text-center mb-6">
                    <div class="text-red-600 text-5xl mb-4">‚ö†Ô∏è</div>
                    <h2 class="text-3xl font-bold text-red-800 mb-2">Important Disclaimer</h2>
                </div>
                
                <div class="space-y-4 text-gray-700">
                    <p class="text-lg">
                        <strong>This platform represents public opinion only and does not reflect official results of the Bangladesh Election Commission.</strong>
                    </p>
                    
                    <p>
                        This website is a demonstration of web development technologies and is designed for educational purposes only. 
                        It simulates a voting system to showcase full-stack development capabilities using modern web technologies.
                    </p>
                    
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-bold text-red-800 mb-2">Please Note:</h4>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>This is NOT an official election website</li>
                            <li>Results shown here are NOT authentic election results</li>
                            <li>This platform does not collect personal identification information</li>
                            <li>Votes are limited to one per device for demonstration purposes only</li>
                            <li>All data is stored in a Firebase database and can be reset by administrators</li>
                        </ul>
                    </div>
                    
                    <p>
                        The Bangladesh flag colors (green and red) are used in the theme to represent the national identity, 
                        not to imply any official association with government institutions.
                    </p>
                    
                    <p class="pt-4 border-t border-gray-300 text-center">
                        <strong>For official election information in Bangladesh, please visit the 
                        <a href="https://www.ecs.gov.bd/" class="text-green-700 font-bold hover:underline" target="_blank">
                            Bangladesh Election Commission website
                        </a></strong>
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-green-900 text-white mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="w-8 h-8 bg-red-500 rounded-full"></div>
                        <h3 class="text-xl font-bold">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§</h3>
                    </div>
                    <p class="text-green-200">A demonstration of web development technologies</p>
                </div>
                
                <div class="text-center md:text-right">
                    <p class="text-green-200">¬© 2023 Bangladesh Public Opinion Poll</p>
                    <p class="text-green-300 text-sm mt-1">This is a mock election for educational purposes only</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Application Code -->
    <script>
        // Wait for Firebase to load
        document.addEventListener('DOMContentLoaded', async function() {
            // ====================
            // INITIALIZATION
            // ====================
            console.log('Bangladesh Public Opinion Poll Initializing...');
            
            // Get Firebase modules
            const { 
                db, collection, addDoc, getDocs, onSnapshot, 
                query, where, doc, updateDoc, deleteDoc, setDoc 
            } = window.firebaseModules || {};
            
            // Check if Firebase is loaded
            if (!db) {
                console.error('Firebase not loaded. Check your Firebase configuration.');
                showAlert('Firebase connection error. Please check the console.', 'error');
                return;
            }
            
            // ====================
            // GLOBAL VARIABLES
            // ====================
            let selectedDivision = null;
            let selectedDistrict = null;
            let selectedConstituency = null;
            let selectedCandidate = null;
            let hasVoted = false;
            let deviceId = null;
            let allCandidates = [];
            let allVotes = [];
            let charts = {};
            
            // Bangladesh geographical data
            const bangladeshData = {
                divisions: [
                    { id: 'dhaka', name: 'Dhaka', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ' },
                    { id: 'chattogram', name: 'Chattogram', bnName: '‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ' },
                    { id: 'rajshahi', name: 'Rajshahi', bnName: '‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ' },
                    { id: 'khulna', name: 'Khulna', bnName: '‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ' },
                    { id: 'barishal', name: 'Barishal', bnName: '‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤' },
                    { id: 'sylhet', name: 'Sylhet', bnName: '‡¶∏‡¶ø‡¶≤‡ßá‡¶ü' },
                    { id: 'rangpur', name: 'Rangpur', bnName: '‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞' },
                    { id: 'mymensingh', name: 'Mymensingh', bnName: '‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π' }
                ],
                
                districts: {
                    dhaka: [
                        { id: 'dhaka_city', name: 'Dhaka City', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'gazipur', name: 'Gazipur', bnName: '‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞' },
                        { id: 'narayanganj', name: 'Narayanganj', bnName: '‡¶®‡¶æ‡¶∞‡¶æ‡¶Ø‡¶º‡¶£‡¶ó‡¶û‡ßç‡¶ú' },
                        { id: 'narsingdi', name: 'Narsingdi', bnName: '‡¶®‡¶∞‡¶∏‡¶ø‡¶Ç‡¶¶‡ßÄ' },
                        { id: 'tangail', name: 'Tangail', bnName: '‡¶ü‡¶æ‡¶ô‡ßç‡¶ó‡¶æ‡¶á‡¶≤' }
                    ],
                    chattogram: [
                        { id: 'chattogram_city', name: 'Chattogram City', bnName: '‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'cox_bazar', name: "Cox's Bazar", bnName: '‡¶ï‡¶ï‡ßç‡¶∏‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞' },
                        { id: 'chandpur', name: 'Chandpur', bnName: '‡¶ö‡¶æ‡¶Å‡¶¶‡¶™‡ßÅ‡¶∞' },
                        { id: 'feni', name: 'Feni', bnName: '‡¶´‡ßá‡¶®‡ßÄ' }
                    ],
                    rajshahi: [
                        { id: 'rajshahi_city', name: 'Rajshahi City', bnName: '‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'bogura', name: 'Bogura', bnName: '‡¶¨‡¶ó‡ßÅ‡¶°‡¶º‡¶æ' },
                        { id: 'pabna', name: 'Pabna', bnName: '‡¶™‡¶æ‡¶¨‡¶®‡¶æ' },
                        { id: 'sirajganj', name: 'Sirajganj', bnName: '‡¶∏‡¶ø‡¶∞‡¶æ‡¶ú‡¶ó‡¶û‡ßç‡¶ú' }
                    ],
                    khulna: [
                        { id: 'khulna_city', name: 'Khulna City', bnName: '‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'jessore', name: 'Jessore', bnName: '‡¶Ø‡¶∂‡ßã‡¶∞' },
                        { id: 'satkhira', name: 'Satkhira', bnName: '‡¶∏‡¶æ‡¶§‡¶ï‡ßç‡¶∑‡ßÄ‡¶∞‡¶æ' },
                        { id: 'bagerhat', name: 'Bagerhat', bnName: '‡¶¨‡¶æ‡¶ó‡ßá‡¶∞‡¶π‡¶æ‡¶ü' }
                    ],
                    barishal: [
                        { id: 'barishal_city', name: 'Barishal City', bnName: '‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'bhola', name: 'Bhola', bnName: '‡¶≠‡ßã‡¶≤‡¶æ' },
                        { id: 'patuakhali', name: 'Patuakhali', bnName: '‡¶™‡¶ü‡ßÅ‡¶Ø‡¶º‡¶æ‡¶ñ‡¶æ‡¶≤‡ßÄ' }
                    ],
                    sylhet: [
                        { id: 'sylhet_city', name: 'Sylhet City', bnName: '‡¶∏‡¶ø‡¶≤‡ßá‡¶ü ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'moulvibazar', name: 'Moulvibazar', bnName: '‡¶Æ‡ßå‡¶≤‡¶≠‡ßÄ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞' },
                        { id: 'habiganj', name: 'Habiganj', bnName: '‡¶π‡¶¨‡¶ø‡¶ó‡¶û‡ßç‡¶ú' }
                    ],
                    rangpur: [
                        { id: 'rangpur_city', name: 'Rangpur City', bnName: '‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞ ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'dinajpur', name: 'Dinajpur', bnName: '‡¶¶‡¶ø‡¶®‡¶æ‡¶ú‡¶™‡ßÅ‡¶∞' },
                        { id: 'nilphamari', name: 'Nilphamari', bnName: '‡¶®‡ßÄ‡¶≤‡¶´‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ' }
                    ],
                    mymensingh: [
                        { id: 'mymensingh_city', name: 'Mymensingh City', bnName: '‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π ‡¶∏‡¶ø‡¶ü‡¶ø' },
                        { id: 'jamalpur', name: 'Jamalpur', bnName: '‡¶ú‡¶æ‡¶Æ‡¶æ‡¶≤‡¶™‡ßÅ‡¶∞' },
                        { id: 'sherpur', name: 'Sherpur', bnName: '‡¶∂‡ßá‡¶∞‡¶™‡ßÅ‡¶∞' }
                    ]
                },
                
                constituencies: {
                    dhaka_city: [
                        { id: 'dhaka_1', name: 'Dhaka-1', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ-‡ßß' },
                        { id: 'dhaka_2', name: 'Dhaka-2', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ-‡ß®' },
                        { id: 'dhaka_3', name: 'Dhaka-3', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ-‡ß©' },
                        { id: 'dhaka_4', name: 'Dhaka-4', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ-‡ß™' }
                      { id: 'dhaka_8', name: 'Dhaka-8', bnName: '‡¶¢‡¶æ‡¶ï‡¶æ-‡ßÆ' }
                    ],
                    gazipur: [
                        { id: 'gazipur_1', name: 'Gazipur-1', bnName: '‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞-‡ßß' },
                        { id: 'gazipur_2', name: 'Gazipur-2', bnName: '‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞-‡ß®' }
                    ],
                    chattogram_city: [
                        { id: 'chattogram_1', name: 'Chattogram-1', bnName: '‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ-‡ßß' },
                        { id: 'chattogram_2', name: 'Chattogram-2', bnName: '‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ-‡ß®' }
                    ],
                    rajshahi_city: [
                        { id: 'rajshahi_1', name: 'Rajshahi-1', bnName: '‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ-‡ßß' },
                        { id: 'rajshahi_2', name: 'Rajshahi-2', bnName: '‡¶∞‡¶æ‡¶ú‡¶∂‡¶æ‡¶π‡ßÄ-‡ß®' }
                    ],
                    khulna_city: [
                        { id: 'khulna_1', name: 'Khulna-1', bnName: '‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ-‡ßß' },
                        { id: 'khulna_2', name: 'Khulna-2', bnName: '‡¶ñ‡ßÅ‡¶≤‡¶®‡¶æ-‡ß®' }
                    ],
                    barishal_city: [
                        { id: 'barishal_1', name: 'Barishal-1', bnName: '‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤-‡ßß' },
                        { id: 'barishal_2', name: 'Barishal-2', bnName: '‡¶¨‡¶∞‡¶ø‡¶∂‡¶æ‡¶≤-‡ß®' }
                    ],
                    sylhet_city: [
                        { id: 'sylhet_1', name: 'Sylhet-1', bnName: '‡¶∏‡¶ø‡¶≤‡ßá‡¶ü-‡ßß' },
                        { id: 'sylhet_2', name: 'Sylhet-2', bnName: '‡¶∏‡¶ø‡¶≤‡ßá‡¶ü-‡ß®' }
                    ],
                    rangpur_city: [
                        { id: 'rangpur_1', name: 'Rangpur-1', bnName: '‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞-‡ßß' },
                        { id: 'rangpur_2', name: 'Rangpur-2', bnName: '‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞-‡ß®' }
                    ],
                    mymensingh_city: [
                        { id: 'mymensingh_1', name: 'Mymensingh-1', bnName: '‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π-‡ßß' },
                        { id: 'mymensingh_2', name: 'Mymensingh-2', bnName: '‡¶Æ‡¶Ø‡¶º‡¶Æ‡¶®‡¶∏‡¶ø‡¶Ç‡¶π-‡ß®' }
                    ]
                }
            };
            
            // ====================
            // UTILITY FUNCTIONS
            // ====================
            
            // Generate a device ID for vote fraud protection
            function generateDeviceId() {
                let deviceId = localStorage.getItem('vote_device_id');
                if (!deviceId) {
                    // Create a simple hash from browser info
                    const navigatorInfo = navigator.userAgent + navigator.language + 
                                          (screen.width * screen.height) + new Date().getTime();
                    deviceId = 'device_' + hashCode(navigatorInfo);
                    localStorage.setItem('vote_device_id', deviceId);
                }
                return deviceId;
            }
            
            // Simple hash function
            function hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16);
            }
            
            // Show alert message
            function showAlert(message, type = 'info') {
                const alertDiv = document.getElementById('voteStatus');
                if (!alertDiv) return;
                
                alertDiv.className = `p-4 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-800 border border-red-300' : 
                                                type === 'success' ? 'bg-green-100 text-green-800 border border-green-300' : 
                                                'bg-blue-100 text-blue-800 border border-blue-300'}`;
                alertDiv.innerHTML = message;
                alertDiv.classList.remove('hidden');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    alertDiv.classList.add('hidden');
                }, 5000);
            }
            
            // Check if user has already voted
            async function checkVoteStatus() {
                deviceId = generateDeviceId();
                try {
                    const votesRef = collection(db, 'votes');
                    const q = query(votesRef, where('deviceId', '==', deviceId));
                    const querySnapshot = await getDocs(q);
                    
                    hasVoted = !querySnapshot.empty;
                    
                    if (hasVoted) {
                        showAlert('You have already voted from this device. Each device can vote only once.', 'error');
                        disableVotingUI();
                    }
                    
                    return hasVoted;
                } catch (error) {
                    console.error('Error checking vote status:', error);
                    return false;
                }
            }
            
            // Disable voting UI if already voted
            function disableVotingUI() {
                const voteButton = document.getElementById('submitVote');
                if (voteButton) {
                    voteButton.disabled = true;
                    voteButton.textContent = 'Already Voted';
                    voteButton.classList.remove('vote-pulse');
                    voteButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                }
            }
            
            // ====================
            // UI INITIALIZATION
            // ====================
            
            // Initialize navigation
            function initNavigation() {
                // Mobile menu toggle
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const mobileMenu = document.getElementById('mobileMenu');
                
                if (mobileMenuBtn) {
                    mobileMenuBtn.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                    });
                }
                
                // Smooth scrolling for navigation links
                document.querySelectorAll('a.nav-link').forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            // Close mobile menu if open
                            if (!mobileMenu.classList.contains('hidden')) {
                                mobileMenu.classList.add('hidden');
                            }
                            
                            // Scroll to target
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    });
                });
            }
            
            // Initialize voting steps UI
            function initVotingUI() {
                // Load divisions
                const divisionList = document.getElementById('divisionList');
                if (divisionList) {
                    bangladeshData.divisions.forEach(division => {
                        const div = document.createElement('button');
                        div.className = 'bg-white border border-green-300 hover:border-green-500 hover:bg-green-50 rounded-lg p-4 text-center transition duration-200';
                        div.innerHTML = `
                            <div class="font-bold text-green-800">${division.name}</div>
                            <div class="text-gray-600 text-sm">${division.bnName}</div>
                        `;
                        div.addEventListener('click', () => selectDivision(division));
                        divisionList.appendChild(div);
                    });
                }
                
                // Step navigation buttons
                document.getElementById('nextToStep2')?.addEventListener('click', showStep2);
                document.getElementById('nextToStep3')?.addEventListener('click', showStep3);
                document.getElementById('nextToStep4')?.addEventListener('click', showStep4);
                document.getElementById('backToStep1')?.addEventListener('click', showStep1);
                document.getElementById('backToStep2')?.addEventListener('click', showStep2);
                document.getElementById('backToStep3')?.addEventListener('click', showStep3);
                document.getElementById('submitVote')?.addEventListener('click', submitVote);
                document.getElementById('voteAgain')?.addEventListener('click', () => {
                    window.scrollTo({
                        top: document.getElementById('results').offsetTop - 80,
                        behavior: 'smooth'
                    });
                });
            }
            
            // ====================
            // VOTING STEP FUNCTIONS
            // ====================
            
            function selectDivision(division) {
                selectedDivision = division;
                document.querySelectorAll('#divisionList button').forEach(btn => {
                    btn.classList.remove('bg-green-100', 'border-green-500');
                    btn.classList.add('bg-white');
                });
                event.currentTarget.classList.add('bg-green-100', 'border-green-500');
                event.currentTarget.classList.remove('bg-white');
                
                // Enable next button
                document.getElementById('nextToStep2').disabled = false;
                
                // Update step indicator
                updateStepIndicator(1);
            }
            
            function showStep1() {
                document.getElementById('step1').classList.remove('hidden');
                document.getElementById('step2').classList.add('hidden');
                updateStepIndicator(0);
            }
            
            function showStep2() {
                if (!selectedDivision) return;
                
                // Load districts for selected division
                const districtList = document.getElementById('districtList');
                districtList.innerHTML = '';
                
                const districts = bangladeshData.districts[selectedDivision.id] || [];
                districts.forEach(district => {
                    const div = document.createElement('button');
                    div.className = 'bg-white border border-green-300 hover:border-green-500 hover:bg-green-50 rounded-lg p-4 text-center transition duration-200';
                    div.innerHTML = `
                        <div class="font-bold text-green-800">${district.name}</div>
                        <div class="text-gray-600 text-sm">${district.bnName}</div>
                    `;
                    div.addEventListener('click', () => selectDistrict(district));
                    districtList.appendChild(div);
                });
                
                // Show step 2
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                updateStepIndicator(1);
            }
            
            function selectDistrict(district) {
                selectedDistrict = district;
                document.querySelectorAll('#districtList button').forEach(btn => {
                    btn.classList.remove('bg-green-100', 'border-green-500');
                    btn.classList.add('bg-white');
                });
                event.currentTarget.classList.add('bg-green-100', 'border-green-500');
                event.currentTarget.classList.remove('bg-white');
                
                // Enable next button
                document.getElementById('nextToStep3').disabled = false;
                
                // Update step indicator
                updateStepIndicator(2);
            }
            
            function showStep3() {
                if (!selectedDistrict) return;
                
                // Load constituencies for selected district
                const constituencyList = document.getElementById('constituencyList');
                constituencyList.innerHTML = '';
                
                const constituencies = bangladeshData.constituencies[selectedDistrict.id] || [];
                constituencies.forEach(constituency => {
                    const div = document.createElement('button');
                    div.className = 'bg-white border border-green-300 hover:border-green-500 hover:bg-green-50 rounded-lg p-4 text-center transition duration-200';
                    div.innerHTML = `
                        <div class="font-bold text-green-800">${constituency.name}</div>
                        <div class="text-gray-600 text-sm">${constituency.bnName}</div>
                    `;
                    div.addEventListener('click', () => selectConstituency(constituency));
                    constituencyList.appendChild(div);
                });
                
                // Show step 3
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
                updateStepIndicator(2);
            }
            
            function selectConstituency(constituency) {
                selectedConstituency = constituency;
                document.querySelectorAll('#constituencyList button').forEach(btn => {
                    btn.classList.remove('bg-green-100', 'border-green-500');
                    btn.classList.add('bg-white');
                });
                event.currentTarget.classList.add('bg-green-100', 'border-green-500');
                event.currentTarget.classList.remove('bg-white');
                
                // Enable next button
                document.getElementById('nextToStep4').disabled = false;
                
                // Update step indicator
                updateStepIndicator(3);
            }
            
            async function showStep4() {
                if (!selectedConstituency) return;
                
                // Show selected location
                const selectedLocation = document.querySelector('#selectedLocation span');
                if (selectedLocation) {
                    selectedLocation.textContent = `${selectedConstituency.name}, ${selectedDistrict.name}, ${selectedDivision.name}`;
                }
                
                // Load candidates for selected constituency
                const candidateList = document.getElementById('candidateList');
                candidateList.innerHTML = '';
                
                try {
                    const candidatesRef = collection(db, 'candidates');
                    const q = query(candidatesRef, where('constituencyId', '==', selectedConstituency.id));
                    const querySnapshot = await getDocs(q);
                    
                    if (querySnapshot.empty) {
                        candidateList.innerHTML = `
                            <div class="text-center py-8 text-gray-500">
                                <div class="text-4xl mb-4">üòï</div>
                                <p class="font-medium">No candidates found for this constituency.</p>
                                <p class="text-sm mt-2">Administrators can add candidates in the Admin Panel.</p>
                            </div>
                        `;
                        document.getElementById('submitVote').disabled = true;
                        return;
                    }
                    
                    let candidateCount = 0;
                    querySnapshot.forEach((doc) => {
                        const candidate = { id: doc.id, ...doc.data() };
                        candidateCount++;
                        
                        const div = document.createElement('div');
                        div.className = 'candidate-item bg-white border border-gray-300 hover:border-green-400 rounded-lg p-4 transition duration-200';
                        div.innerHTML = `
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                        <span class="text-green-800 font-bold">${candidateCount}</span>
                                    </div>
                                </div>
                                <div class="ml-4 flex-grow">
                                    <div class="font-bold text-green-900">${candidate.name}</div>
                                    <div class="text-gray-600">${candidate.party}</div>
                                </div>
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 border-2 border-gray-300 rounded-full candidate-radio"></div>
                                </div>
                            </div>
                        `;
                        
                        div.addEventListener('click', () => selectCandidate(candidate, div));
                        candidateList.appendChild(div);
                    });
                } catch (error) {
                    console.error('Error loading candidates:', error);
                    showAlert('Error loading candidates. Please try again.', 'error');
                }
                
                // Show step 4
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step4').classList.remove('hidden');
                updateStepIndicator(3);
            }
            
            function selectCandidate(candidate, element) {
                selectedCandidate = candidate;
                
                // Update UI
                document.querySelectorAll('.candidate-item').forEach(item => {
                    item.classList.remove('border-green-500', 'bg-green-50');
                    const radio = item.querySelector('.candidate-radio');
                    if (radio) {
                        radio.className = 'w-8 h-8 border-2 border-gray-300 rounded-full candidate-radio';
                    }
                });
                
                element.classList.add('border-green-500', 'bg-green-50');
                const radio = element.querySelector('.candidate-radio');
                if (radio) {
                    radio.className = 'w-8 h-8 border-2 border-green-500 rounded-full candidate-radio bg-green-500';
                }
                
                // Enable vote button
                document.getElementById('submitVote').disabled = false;
            }
            
            // Update step indicator
            function updateStepIndicator(activeStep) {
                const steps = document.querySelectorAll('.step-circle');
                const line = document.querySelector('.absolute.h-1');
                
                steps.forEach((step, index) => {
                    if (index <= activeStep) {
                        step.classList.remove('bg-gray-300', 'text-gray-700');
                        step.classList.add('bg-green-600', 'text-white');
                    } else {
                        step.classList.remove('bg-green-600', 'text-white');
                        step.classList.add('bg-gray-300', 'text-gray-700');
                    }
                });
                
                // Update progress line
                if (line && activeStep > 0) {
                    const width = (activeStep / 3) * 100;
                    line.style.background = `linear-gradient(to right, #16a34a ${width}%, #d1d5db ${width}%)`;
                }
            }
            
            // Submit vote
            async function submitVote() {
                if (!selectedCandidate || !selectedConstituency || !selectedDistrict || !selectedDivision) {
                    showAlert('Please complete all voting steps.', 'error');
                    return;
                }
                
                if (hasVoted) {
                    showAlert('You have already voted from this device.', 'error');
                    return;
                }
                
                try {
                    // Create vote record
                    const voteData = {
                        candidateId: selectedCandidate.id,
                        candidateName: selectedCandidate.name,
                        candidateParty: selectedCandidate.party,
                        constituencyId: selectedConstituency.id,
                        constituencyName: selectedConstituency.name,
                        districtId: selectedDistrict.id,
                        districtName: selectedDistrict.name,
                        divisionId: selectedDivision.id,
                        divisionName: selectedDivision.name,
                        deviceId: deviceId,
                        timestamp: new Date().toISOString(),
                        ipHash: hashCode(navigator.userAgent + new Date().getTime()) // Simple simulation
                    };
                    
                    // Add to Firestore
                    await addDoc(collection(db, 'votes'), voteData);
                    
                    // Update candidate vote count
                    const candidateRef = doc(db, 'candidates', selectedCandidate.id);
                    const currentVotes = selectedCandidate.votes || 0;
                    await updateDoc(candidateRef, {
                        votes: currentVotes + 1
                    });
                    
                    // Update local state
                    hasVoted = true;
                    localStorage.setItem('has_voted', 'true');
                    
                    // Show success message
                    document.getElementById('step4').classList.add('hidden');
                    document.getElementById('voteComplete').classList.remove('hidden');
                    
                    // Disable voting UI
                    disableVotingUI();
                    
                    // Refresh results
                    loadLiveResults();
                    
                    showAlert('Your vote has been successfully recorded! Thank you for participating.', 'success');
                    
                } catch (error) {
                    console.error('Error submitting vote:', error);
                    showAlert('Error submitting vote. Please try again.', 'error');
                }
            }
            
            // ====================
            // LIVE RESULTS FUNCTIONS
            // ====================
            
            // Load live results from Firestore
            async function loadLiveResults() {
                try {
                    // Load candidates
                    const candidatesSnapshot = await getDocs(collection(db, 'candidates'));
                    allCandidates = [];
                    candidatesSnapshot.forEach(doc => {
                        allCandidates.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Load votes
                    const votesSnapshot = await getDocs(collection(db, 'votes'));
                    allVotes = [];
                    votesSnapshot.forEach(doc => {
                        allVotes.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Update total votes count
                    document.getElementById('totalVotesCount').textContent = allVotes.length;
                    
                    // Update results table
                    updateResultsTable();
                    
                    // Update charts
                    updateResultsCharts();
                    
                    // Update statistics
                    updateStatistics();
                    
                } catch (error) {
                    console.error('Error loading results:', error);
                }
            }
            
            // Update results table
            function updateResultsTable() {
                const tableBody = document.getElementById('resultsTableBody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                // Sort candidates by votes
                const sortedCandidates = [...allCandidates].sort((a, b) => (b.votes || 0) - (a.votes || 0));
                
                if (sortedCandidates.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="py-8 text-center text-gray-500">
                                No votes recorded yet. Be the first to vote!
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Calculate total votes
                const totalVotes = allVotes.length;
                
                sortedCandidates.forEach(candidate => {
                    const votes = candidate.votes || 0;
                    const percentage = totalVotes > 0 ? ((votes / totalVotes) * 100).toFixed(1) : 0;
                    
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="py-3 px-4">
                            <div class="font-medium text-green-900">${candidate.name}</div>
                        </td>
                        <td class="py-3 px-4">
                            <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">${candidate.party}</span>
                        </td>
                        <td class="py-3 px-4">
                            <div class="text-gray-700">${candidate.constituencyName || 'N/A'}</div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="font-bold text-green-800">${votes}</div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                                </div>
                                <span class="font-medium">${percentage}%</span>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            // Update results charts
            function updateResultsCharts() {
                // Prepare data for charts
                const topCandidates = [...allCandidates]
                    .sort((a, b) => (b.votes || 0) - (a.votes || 0))
                    .slice(0, 5);
                
                const candidateNames = topCandidates.map(c => c.name);
                const candidateVotes = topCandidates.map(c => c.votes || 0);
                const candidateColors = ['#16a34a', '#dc2626', '#2563eb', '#ca8a04', '#9333ea'];
                
                // Bar chart for top candidates
                const barCtx = document.getElementById('votesBarChart')?.getContext('2d');
                if (barCtx) {
                    if (charts.barChart) {
                        charts.barChart.destroy();
                    }
                    
                    charts.barChart = new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: candidateNames,
                            datasets: [{
                                label: 'Votes',
                                data: candidateVotes,
                                backgroundColor: candidateColors,
                                borderColor: candidateColors.map(c => c.replace('0.8', '1')),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Top 5 Candidates'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Pie chart for vote distribution
                const pieCtx = document.getElementById('votesPieChart')?.getContext('2d');
                if (pieCtx && topCandidates.length > 0) {
                    if (charts.pieChart) {
                        charts.pieChart.destroy();
                    }
                    
                    charts.pieChart = new Chart(pieCtx, {
                        type: 'pie',
                        data: {
                            labels: candidateNames,
                            datasets: [{
                                data: candidateVotes,
                                backgroundColor: candidateColors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
            }
            
            // Update statistics
            function updateStatistics() {
                if (allCandidates.length === 0) return;
                
                // Calculate statistics
                const totalVotes = allVotes.length;
                const avgVotes = totalVotes > 0 ? Math.round(totalVotes / allCandidates.length) : 0;
                
                // Find most popular party
                const partyVotes = {};
                allCandidates.forEach(candidate => {
                    const party = candidate.party;
                    partyVotes[party] = (partyVotes[party] || 0) + (candidate.votes || 0);
                });
                
                let popularParty = 'N/A';
                let maxPartyVotes = 0;
                for (const [party, votes] of Object.entries(partyVotes)) {
                    if (votes > maxPartyVotes) {
                        maxPartyVotes = votes;
                        popularParty = party;
                    }
                }
                
                // Update UI
                document.getElementById('avgVotes').textContent = avgVotes;
                document.getElementById('popularParty').textContent = popularParty;
                document.getElementById('totalCandidates').textContent = allCandidates.length;
                
                // Update division chart
                updateDivisionChart();
            }
            
            // Update division chart
            function updateDivisionChart() {
                // Calculate votes by division
                const divisionVotes = {};
                bangladeshData.divisions.forEach(div => {
                    divisionVotes[div.name] = 0;
                });
                
                allVotes.forEach(vote => {
                    if (vote.divisionName && divisionVotes[vote.divisionName] !== undefined) {
                        divisionVotes[vote.divisionName]++;
                    }
                });
                
                const divisionCtx = document.getElementById('divisionChart')?.getContext('2d');
                if (divisionCtx) {
                    if (charts.divisionChart) {
                        charts.divisionChart.destroy();
                    }
                    
                    const divisionNames = Object.keys(divisionVotes);
                    const divisionVoteCounts = Object.values(divisionVotes);
                    
                    charts.divisionChart = new Chart(divisionCtx, {
                        type: 'doughnut',
                        data: {
                            labels: divisionNames,
                            datasets: [{
                                data: divisionVoteCounts,
                                backgroundColor: [
                                    '#16a34a', '#dc2626', '#2563eb', '#ca8a04',
                                    '#9333ea', '#0891b2', '#7c3aed', '#ea580c'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
            }
            
            // ====================
            // ADMIN PANEL FUNCTIONS
            // ====================
            
            function initAdminPanel() {
                // Admin login
                document.getElementById('loginAdmin')?.addEventListener('click', loginAdmin);
                document.getElementById('logoutAdmin')?.addEventListener('click', logoutAdmin);
                document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') loginAdmin();
                });
                
                // Admin actions
                document.getElementById('addCandidateBtn')?.addEventListener('click', addCandidate);
                document.getElementById('resetAllVotes')?.addEventListener('click', resetAllVotes);
                document.getElementById('clearCandidates')?.addEventListener('click', clearAllCandidates);
                
                // Load constituencies for admin dropdown
                loadAdminConstituencies();
                
                // Load admin candidate list
                loadAdminCandidates();
            }
            
            function loginAdmin() {
                const password = document.getElementById('adminPassword').value;
                const demoPassword = 'admin123'; // Demo password
                
                if (password === demoPassword) {
                    document.getElementById('adminLogin').classList.add('hidden');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    showAlert('Admin login successful!', 'success');
                    
                    // Load admin data
                    loadAdminData();
                } else {
                    showAlert('Incorrect password. Demo password is "admin123"', 'error');
                }
            }
            
            function logoutAdmin() {
                document.getElementById('adminLogin').classList.remove('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');
                document.getElementById('adminPassword').value = '';
                showAlert('Logged out successfully.', 'info');
            }
            
            async function loadAdminData() {
                try {
                    // Load total votes
                    const votesSnapshot = await getDocs(collection(db, 'votes'));
                    document.getElementById('adminTotalVotes').textContent = votesSnapshot.size;
                    
                    // Load total candidates
                    const candidatesSnapshot = await getDocs(collection(db, 'candidates'));
                    document.getElementById('adminTotalCandidates').textContent = candidatesSnapshot.size;
                    
                } catch (error) {
                    console.error('Error loading admin data:', error);
                }
            }
            
            function loadAdminConstituencies() {
                const select = document.getElementById('adminConstituency');
                if (!select) return;
                
                select.innerHTML = '<option value="">Select Constituency</option>';
                
                // Flatten all constituencies
                for (const [districtId, constituencies] of Object.entries(bangladeshData.constituencies)) {
                    const district = Object.values(bangladeshData.districts)
                        .flat()
                        .find(d => d.id === districtId);
                    
                    if (district) {
                        const division = Object.values(bangladeshData.divisions)
                            .find(div => bangladeshData.districts[div.id]?.some(d => d.id === districtId));
                        
                        constituencies.forEach(constituency => {
                            const option = document.createElement('option');
                            option.value = constituency.id;
                            option.textContent = `${constituency.name} (${district.name}, ${division?.name || 'N/A'})`;
                            select.appendChild(option);
                        });
                    }
                }
            }
            
            async function loadAdminCandidates() {
                const tableBody = document.getElementById('adminCandidateTable');
                if (!tableBody) return;
                
                try {
                    const candidatesSnapshot = await getDocs(collection(db, 'candidates'));
                    tableBody.innerHTML = '';
                    
                    if (candidatesSnapshot.empty) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="5" class="py-4 text-center text-gray-500">
                                    No candidates added yet.
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    candidatesSnapshot.forEach(doc => {
                        const candidate = { id: doc.id, ...doc.data() };
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-200 hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="py-3 px-4">${candidate.name}</td>
                            <td class="py-3 px-4">
                                <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">${candidate.party}</span>
                            </td>
                            <td class="py-3 px-4">${candidate.constituencyName || 'N/A'}</td>
                            <td class="py-3 px-4 font-bold">${candidate.votes || 0}</td>
                            <td class="py-3 px-4">
                                <button class="delete-candidate bg-red-100 hover:bg-red-200 text-red-800 text-xs font-medium px-3 py-1 rounded" data-id="${candidate.id}">
                                    Delete
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Add delete event listeners
                    document.querySelectorAll('.delete-candidate').forEach(button => {
                        button.addEventListener('click', function() {
                            const candidateId = this.getAttribute('data-id');
                            deleteCandidate(candidateId);
                        });
                    });
                    
                } catch (error) {
                    console.error('Error loading admin candidates:', error);
                }
            }
            
            async function addCandidate() {
                const name = document.getElementById('candidateName').value.trim();
                const party = document.getElementById('candidateParty').value.trim();
                const constituencyId = document.getElementById('adminConstituency').value;
                
                if (!name || !party || !constituencyId) {
                    showAlert('Please fill all fields and select a constituency.', 'error');
                    return;
                }
                
                // Find constituency name
                let constituencyName = '';
                for (const [districtId, constituencies] of Object.entries(bangladeshData.constituencies)) {
                    const constituency = constituencies.find(c => c.id === constituencyId);
                    if (constituency) {
                        constituencyName = constituency.name;
                        break;
                    }
                }
                
                try {
                    // Add candidate to Firestore
                    await addDoc(collection(db, 'candidates'), {
                        name: name,
                        party: party,
                        constituencyId: constituencyId,
                        constituencyName: constituencyName,
                        votes: 0
                    });
                    
                    // Clear form
                    document.getElementById('candidateName').value = '';
                    document.getElementById('candidateParty').value = '';
                    document.getElementById('adminConstituency').value = '';
                    
                    // Refresh lists
                    loadAdminCandidates();
                    loadLiveResults();
                    
                    showAlert(`Candidate "${name}" added successfully!`, 'success');
                    
                } catch (error) {
                    console.error('Error adding candidate:', error);
                    showAlert('Error adding candidate. Please try again.', 'error');
                }
            }
            
            async function deleteCandidate(candidateId) {
                if (!confirm('Are you sure you want to delete this candidate? This action cannot be undone.')) {
                    return;
                }
                
                try {
                    await deleteDoc(doc(db, 'candidates', candidateId));
                    loadAdminCandidates();
                    loadLiveResults();
                    showAlert('Candidate deleted successfully.', 'success');
                } catch (error) {
                    console.error('Error deleting candidate:', error);
                    showAlert('Error deleting candidate.', 'error');
                }
            }
            
            async function resetAllVotes() {
                if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL votes from the database. This action cannot be undone. Are you sure?')) {
                    return;
                }
                
                try {
                    // Delete all votes
                    const votesSnapshot = await getDocs(collection(db, 'votes'));
                    const deletePromises = [];
                    votesSnapshot.forEach(doc => {
                        deletePromises.push(deleteDoc(doc.ref));
                    });
                    await Promise.all(deletePromises);
                    
                    // Reset candidate vote counts to 0
                    const candidatesSnapshot = await getDocs(collection(db, 'candidates'));
                    const updatePromises = [];
                    candidatesSnapshot.forEach(doc => {
                        updatePromises.push(updateDoc(doc.ref, { votes: 0 }));
                    });
                    await Promise.all(updatePromises);
                    
                    // Clear local storage voting status
                    localStorage.removeItem('has_voted');
                    hasVoted = false;
                    
                    // Refresh UI
                    loadLiveResults();
                    loadAdminData();
                    
                    // Re-enable voting UI for current user
                    const voteButton = document.getElementById('submitVote');
                    if (voteButton && !hasVoted) {
                        voteButton.disabled = false;
                        voteButton.textContent = 'üó≥Ô∏è Cast Your Vote';
                        voteButton.classList.add('vote-pulse');
                        voteButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    }
                    
                    showAlert('All votes have been reset successfully.', 'success');
                    
                } catch (error) {
                    console.error('Error resetting votes:', error);
                    showAlert('Error resetting votes.', 'error');
                }
            }
            
            async function clearAllCandidates() {
                if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL candidates from the database. This action cannot be undone. Are you sure?')) {
                    return;
                }
                
                try {
                    // Delete all candidates
                    const candidatesSnapshot = await getDocs(collection(db, 'candidates'));
                    const deletePromises = [];
                    candidatesSnapshot.forEach(doc => {
                        deletePromises.push(deleteDoc(doc.ref));
                    });
                    await Promise.all(deletePromises);
                    
                    // Refresh UI
                    loadAdminCandidates();
                    loadLiveResults();
                    
                    showAlert('All candidates have been deleted.', 'success');
                    
                } catch (error) {
                    console.error('Error clearing candidates:', error);
                    showAlert('Error clearing candidates.', 'error');
                }
            }
            
            // ====================
            // SETUP FIREBASE REAL-TIME LISTENERS
            // ====================
            
            function setupFirestoreListeners() {
                if (!db) return;
                
                // Listen for votes changes
                const votesRef = collection(db, 'votes');
                onSnapshot(votesRef, (snapshot) => {
                    allVotes = [];
                    snapshot.forEach(doc => {
                        allVotes.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Update UI
                    document.getElementById('totalVotesCount').textContent = allVotes.length;
                    updateResultsTable();
                    updateResultsCharts();
                    updateStatistics();
                });
                
                // Listen for candidates changes
                const candidatesRef = collection(db, 'candidates');
                onSnapshot(candidatesRef, (snapshot) => {
                    allCandidates = [];
                    snapshot.forEach(doc => {
                        allCandidates.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // Update UI
                    updateResultsTable();
                    updateResultsCharts();
                    updateStatistics();
                    loadAdminCandidates();
                });
            }
            
            // ====================
            // INITIALIZE APPLICATION
            // ====================
            
            // Initialize UI components
            initNavigation();
            initVotingUI();
            initAdminPanel();
            
            // Check vote status
            await checkVoteStatus();
            
            // Load initial data
            await loadLiveResults();
            
            // Setup real-time listeners
            setupFirestoreListeners();
            
            // Initialize charts
            updateResultsCharts();
            updateDivisionChart();
            
            // Setup refresh button
            document.getElementById('refreshResults')?.addEventListener('click', loadLiveResults);
            
            console.log('Bangladesh Public Opinion Poll initialized successfully!');
        });
    </script>
</body>
</html>
